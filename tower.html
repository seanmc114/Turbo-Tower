<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>JC Tower</title>
  <style>
    :root{
      --card: rgba(255,255,255,0.92);
      --line: rgba(8,12,24,0.14);
      --text: rgba(8,12,24,0.94);
      --muted: rgba(8,12,24,0.62);
      --shadow: 0 18px 60px rgba(10,15,30,0.16);
      --radius: 18px;
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      --good:#00a86b;
      --bad:#d61f2c;
      --warn:#ffb020;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:var(--font); color:var(--text);
      background:
        radial-gradient(900px 600px at 20% 12%, rgba(255,190,90,0.22), transparent 62%),
        radial-gradient(900px 600px at 85% 20%, rgba(40,200,120,0.18), transparent 62%),
        radial-gradient(900px 600px at 50% 95%, rgba(140,60,255,0.10), transparent 62%),
        linear-gradient(180deg, #fff7e6, #eafbf3);
      min-height:100vh;
      position:relative;
      overflow-x:hidden;
    }
    body::before{
      content:"";
      position:fixed;
      inset:0;
      background-image:url("assets/crest.png");
      background-repeat:no-repeat;
      background-position:center;
      background-size:min(74vw, 560px);
      opacity:0.10;
      pointer-events:none;
      z-index:0;
    }
    header{
      position:relative; z-index:1;
      max-width:1280px; margin:0 auto; padding:16px 18px 8px;
      display:flex; align-items:flex-end; justify-content:space-between; gap:12px; flex-wrap:wrap;
    }
    .sub{color:var(--muted); font-weight:900; font-size:13px}
    .btn{
      border:1px solid var(--line);
      background:#fff;
      color: var(--text);
      border-radius:14px;
      padding:10px 12px;
      cursor:pointer;
      font-weight:1000;
      box-shadow: 0 10px 30px rgba(10,15,30,0.10);
    }
    .btn.primary{background:linear-gradient(180deg, rgba(255,190,90,0.30), rgba(255,190,90,0.14)); border-color: rgba(255,190,90,0.60);}
    .btn.good{background:linear-gradient(180deg, rgba(40,200,120,0.22), rgba(40,200,120,0.10)); border-color: rgba(40,200,120,0.45);}
    .btn.bad{background:linear-gradient(180deg, rgba(214,31,44,0.18), rgba(214,31,44,0.10)); border-color: rgba(214,31,44,0.40);}
    .btn.warn{background:linear-gradient(180deg, rgba(255,176,32,0.26), rgba(255,176,32,0.12)); border-color: rgba(255,176,32,0.55);}

    main{
      position:relative; z-index:1;
      max-width:1280px; margin:0 auto; padding: 6px 18px 18px;
      display:grid; grid-template-columns: 1.55fr 0.65fr; gap:14px;
    }
    @media (max-width:980px){ main{grid-template-columns:1fr;} }

    .card{
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 14px;
    }
    .canvasWrap{padding:0; overflow:hidden; position:relative;}
    .canvasBG{
      position:absolute; inset:0; border-radius:var(--radius);
      background-size:cover; background-position:50% 55%;
      filter:saturate(1.18) contrast(1.06);
    }
    .canvasBG::after{
      content:""; position:absolute; inset:0; border-radius:var(--radius);
      background:
        radial-gradient(900px 550px at 15% 15%, rgba(255,255,255,0.65), transparent 60%),
        radial-gradient(900px 550px at 85% 20%, rgba(255,255,255,0.50), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,0.05), rgba(255,255,255,0.18));
      pointer-events:none;
    }
    #stage{position:relative; width:100%; height:min(78vh, 760px); display:block; border-radius:var(--radius); touch-action:none; z-index:2;}
    #fx{position:absolute; inset:0; width:100%; height:100%; border-radius:var(--radius); pointer-events:none; z-index:4;}

    .pillRow{
      position:absolute; inset:12px 12px auto 12px;
      display:flex; gap:10px; flex-wrap:wrap; justify-content:space-between;
      pointer-events:none; z-index:5;
    }
    .pill{
      pointer-events:auto;
      padding:8px 10px; border-radius:999px;
      border:1px solid rgba(8,12,24,0.12);
      background: rgba(255,255,255,0.92);
      font-size:12px; color:var(--muted); font-weight:1000;
    }
    .pill strong{color:var(--text)}

    .label{font-size:12px; color:var(--muted); font-weight:1000}
    input{
      width:100%; border:1px solid var(--line); border-radius:12px;
      padding:10px 12px; font-weight:1000; outline:none; background:#fff; font-size:16px;
    }
    input:focus{border-color: rgba(40,200,120,0.60); box-shadow: 0 0 0 4px rgba(40,200,120,0.16)}
    .btnRow{display:flex; gap:10px; flex-wrap:wrap; margin-top:10px}

    .msg{margin-top:10px; padding:10px 12px; border-radius:16px; border:1px solid var(--line); background: rgba(8,12,24,0.03); font-weight:1000; display:none;}
    .msg.good{border-color: rgba(40,200,120,0.40); background: rgba(40,200,120,0.14); color: rgba(0,110,70,1); display:block;}
    .msg.bad{border-color: rgba(214,31,44,0.40); background: rgba(214,31,44,0.12); color: rgba(150,18,26,1); display:block;}

    .list{margin-top:10px; border-top:1px solid var(--line); padding-top:10px; display:grid; gap:8px; max-height: 340px; overflow:auto;}
    .chip{display:flex; justify-content:space-between; gap:10px; padding:10px 10px; border:1px solid rgba(8,12,24,0.10); border-radius:14px; background:rgba(255,255,255,0.88); font-weight:1000;}
    .chip small{color:var(--muted); font-weight:1000}
    .bar{height:12px; border-radius:999px; border:1px solid rgba(8,12,24,0.14); background:rgba(255,255,255,0.70); overflow:hidden;}
    .fill{height:100%; width:0%; background: linear-gradient(90deg, rgba(40,200,120,0.85), rgba(255,190,90,0.85));}

    /* ---------- FEEDBACK MODAL ---------- */
    .modal{
      position:fixed; inset:0;
      background: rgba(8,12,24,0.55);
      display:none;
      align-items:center;
      justify-content:center;
      padding:16px;
      z-index:50;
    }
    .modal.show{display:flex;}
    .modalCard{
      width:min(860px, 100%);
      background: rgba(255,255,255,0.96);
      border:1px solid rgba(255,255,255,0.22);
      border-radius:24px;
      box-shadow: 0 30px 110px rgba(0,0,0,0.25);
      overflow:hidden;
    }
    .modalTop{
      padding:16px 16px 10px;
      background:
        radial-gradient(900px 400px at 20% 30%, rgba(255,190,90,0.30), transparent 62%),
        radial-gradient(900px 400px at 80% 20%, rgba(40,200,120,0.22), transparent 62%),
        linear-gradient(180deg, rgba(255,255,255,0.90), rgba(255,255,255,0.84));
      border-bottom:1px solid rgba(8,12,24,0.10);
    }
    .modalTitle{font-size:20px; font-weight:1000; margin:0}
    .modalSub{margin:6px 0 0; color:var(--muted); font-weight:900; font-size:13px}
    .modalBody{padding:14px 16px 16px; display:grid; gap:12px;}
    .summaryGrid{
      display:grid; grid-template-columns: repeat(4, minmax(0,1fr)); gap:10px;
    }
    @media (max-width: 720px){ .summaryGrid{grid-template-columns: repeat(2, minmax(0,1fr));} }
    .stat{
      border:1px solid rgba(8,12,24,0.10);
      border-radius:16px;
      padding:10px;
      background: rgba(255,255,255,0.88);
    }
    .stat .k{font-size:12px; color:var(--muted); font-weight:1000}
    .stat .v{font-size:20px; font-weight:1000; margin-top:4px}
    .missed{
      border:1px solid rgba(8,12,24,0.10);
      border-radius:16px;
      background: rgba(255,255,255,0.88);
      overflow:hidden;
    }
    .missedHead{
      padding:10px 12px;
      font-weight:1000;
      border-bottom:1px solid rgba(8,12,24,0.10);
      display:flex; justify-content:space-between; gap:10px; align-items:center;
    }
    .missedList{
      max-height: 320px;
      overflow:auto;
    }
    .rowItem{
      padding:10px 12px;
      border-top:1px solid rgba(8,12,24,0.08);
      display:grid;
      grid-template-columns: 1.1fr 1fr 1.2fr;
      gap:10px;
      align-items:start;
      font-weight:1000;
    }
    @media (max-width: 720px){
      .rowItem{grid-template-columns:1fr; gap:6px;}
    }
    .pillGood{
      display:inline-block; padding:2px 8px; border-radius:999px;
      background: rgba(40,200,120,0.16); border:1px solid rgba(40,200,120,0.35);
      color: rgba(0,110,70,1); font-size:12px; font-weight:1000;
    }
    .pillBad{
      display:inline-block; padding:2px 8px; border-radius:999px;
      background: rgba(214,31,44,0.12); border:1px solid rgba(214,31,44,0.35);
      color: rgba(150,18,26,1); font-size:12px; font-weight:1000;
    }
    .muted{color:var(--muted); font-weight:900; font-size:12px}
    .modalBtns{display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end; padding: 0 16px 16px;}
    footer{position:relative; z-index:1; text-align:center; padding: 10px 14px 16px; color: rgba(8,12,24,0.55); font-weight:1000; letter-spacing:0.3px;}
  </style>
</head>
<body>
  <header>
    <div>
      <div style="font-weight:1000; font-size:22px" id="title">Tower</div>
      <div class="sub">Clear the whole tower: Level 1‚Üí2‚Üí‚Ä¶‚ÜíUltimate Clear!</div>
    </div>
    <div style="display:flex; gap:10px; flex-wrap:wrap">
      <button class="btn" id="back">‚¨Ö Hub</button>
      <button class="btn" id="resetTheme">Reset this theme</button>
    </div>
  </header>

  <main>
    <div class="card canvasWrap">
      <div class="canvasBG" id="bg"></div>
      <canvas id="stage"></canvas>
      <canvas id="fx"></canvas>
      <div class="pillRow">
        <div class="pill">üìö Level <strong id="lvl">1</strong></div>
        <div class="pill">üéØ Left <strong id="left">0</strong></div>
        <div class="pill">‚≠ê Score <strong id="score">0</strong></div>
        <div class="pill">üî• Streak <strong id="streak">0</strong></div>
      </div>
    </div>

    <div class="card">
      <div class="label">Theme progress</div>
      <div class="bar" style="margin-top:6px"><div class="fill" id="themeFill"></div></div>
      <div class="label" style="margin-top:6px" id="themeTxt">0%</div>

      <div class="label" style="margin-top:12px">Prompt</div>
      <div style="font-weight:1000; margin-top:6px" id="prompt">‚Äî</div>
      <div class="label" style="margin-top:6px">Accents not required (√± counts as n). Spaces allowed.</div>

      <div style="margin-top:10px">
        <div class="label">Type (or click blocks)</div>
        <input id="typed" autocomplete="off" spellcheck="false" placeholder="Type here‚Ä¶" />
      </div>

      <div class="btnRow">
        <button class="btn primary" id="submit">Submit</button>
        <button class="btn" id="undo">Undo</button>
        <button class="btn" id="clear">Clear</button>
        <button class="btn good" id="shuffle">Shuffle Tower</button>
        <button class="btn bad" id="hintBtn">Hint</button>
        <button class="btn warn" id="feedbackBtn">Feedback</button>
      </div>

      <div class="msg" id="msg"></div>

      <div class="label" style="margin-top:12px">Words left (this level)</div>
      <div class="list" id="list"></div>
    </div>
  </main>

  <!-- FEEDBACK MODAL -->
  <div class="modal" id="levelModal" aria-hidden="true">
    <div class="modalCard">
      <div class="modalTop">
        <h2 class="modalTitle" id="fbTitle">Feedback</h2>
        <div class="modalSub" id="fbSub">Turbo Feedback</div>
      </div>
      <div class="modalBody">
        <div class="summaryGrid" id="fbStats"></div>

        <div class="missed">
          <div class="missedHead">
            <div>Words to improve (incl. unanswered)</div>
            <div class="muted" id="fbMissedCount">0 items</div>
          </div>
          <div class="missedList" id="fbMissed"></div>
        </div>

        <div class="muted">Tip: hit ‚ÄúContinue‚Äù to go back and finish the level. Next Level only unlocks once the level is cleared.</div>
      </div>
      <div class="modalBtns">
        <button class="btn" id="fbContinue">Continue Level</button>
        <button class="btn" id="fbBack">‚¨Ö Hub</button>
        <button class="btn primary" id="fbNext" style="display:none">Next Level ‚ûú</button>
      </div>
    </div>
  </div>

  <footer>¬© 2026 Synge Street Games Lab</footer>

  <script type="module">
    import { startTower } from "./game.js";
    startTower();
  </script>
</body>
</html>
